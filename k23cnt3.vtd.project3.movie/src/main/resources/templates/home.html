<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Trang Chủ - MovieApp</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<!-- Header -->
<div th:replace="fragments/_Layout :: header"></div>

<div class="container my-4">
    <h2>Danh sách phim</h2>

    <!-- Lọc nâng cao -->
    <form class="row g-3 mb-3" method="get" th:action="@{/}">
        <div class="col-md-3">
            <input type="text" class="form-control" name="keyword" placeholder="Tìm theo từ khóa"
                   th:value="${keyword}">
        </div>
        <div class="col-md-3">
            <select class="form-select" name="namPhatHanh">
                <option value="">Năm phát hành</option>
                <option th:each="n: ${#numbers.sequence(2000, 2030)}"
                        th:value="${n}" th:text="${n}"
                        th:selected="${n == namPhatHanh}"></option>
            </select>
        </div>
        <div class="col-md-3">
            <select class="form-select" name="minRating">
                <option value="">Đánh giá tối thiểu</option>
                <option th:each="r: ${#numbers.sequence(1,5)}"
                        th:value="${r}" th:text="${r}" th:selected="${r == minRating}"></option>
            </select>
        </div>
        <div class="col-md-3">
            <button class="btn btn-primary">Lọc</button>
        </div>
    </form>

    <!-- Danh sách phim -->
    <div class="row">
        <div class="col-md-3 mb-3" th:each="phim: ${phimPage.content}">
            <div class="card h-100">
                <img th:src="@{${phim.hinhAnh}}" class="card-img-top" alt="Hình phim">
                <div class="card-body">
                    <h5 class="card-title" th:text="${phim.tieuDe}"></h5>
                    <p class="card-text">Năm: <span th:text="${phim.namPhatHanh}"></span></p>
                    <p class="card-text">Đánh giá: <span th:text="${#numbers.formatDecimal(phim.avgRating,1,1)}">0.0</span></p>
                    <a th:href="@{/phim/{id}(id=${phim.id})}" class="btn btn-primary">Xem chi tiết</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Phân trang -->
    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center">
            <li class="page-item" th:classappend="${phimPage.first} ? 'disabled'">
                <a class="page-link" th:href="@{/(page=${phimPage.number-1})}">Previous</a>
            </li>
            <li class="page-item" th:each="i : ${#numbers.sequence(0, phimPage.totalPages-1)}"
                th:classappend="${i == phimPage.number} ? 'active'">
                <a class="page-link" th:href="@{/(page=${i})}" th:text="${i+1}"></a>
            </li>
            <li class="page-item" th:classappend="${phimPage.last} ? 'disabled'">
                <a class="page-link" th:href="@{/(page=${phimPage.number+1})}">Next</a>
            </li>
        </ul>
    </nav>

</div>

<!-- Footer -->
<div th:replace="fragments/_Layout :: footer"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
