<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{fragments/_LayoutAdmin :: layout(
            title='Thanh to√°n',
            headerTitle='Qu·∫£n l√Ω Thanh to√°n',
            content=~{::content},
            customStyles=~{::styles},
            customScripts=~{::scripts}
      )}">

<head>
    <th:block th:fragment="styles">
        <style>
            body {
                background: linear-gradient(135deg, #FFF7ED 0%, #FFEDD5 100%);
            }
            .card {
                border-radius: 20px;
                border: none;
                box-shadow: 0 10px 40px rgba(245, 158, 11, 0.15);
            }
            .page-header {
                background: linear-gradient(135deg, #F59E0B, #FBBF24);
                padding: 1.5rem 2rem;
                margin: -2rem -2rem 2rem -2rem;
                color: white;
            }
            .filter-section {
                background: #FFFBEB;
                padding: 1.5rem;
                border-radius: 14px;
                margin-bottom: 1.5rem;
                border: 2px solid #FEF3C7;
            }
            table th {
                background: linear-gradient(135deg, #F59E0B, #FBBF24);
                color: white;
                text-transform: uppercase;
                font-size: 0.85rem;
            }
            .payment-id {
                background: #F59E0B;
                color: white;
                padding: 0.3rem 0.7rem;
                border-radius: 8px;
                font-weight: 700;
            }

        /* ===== METHOD ===== */
        .method-online {
                background: linear-gradient(135deg, #10B981, #34D399);
            color: white;
        }
        .method-cod {
            background: linear-gradient(135deg, #10B981, #34D399);
            color: white;
        }

        /* ===== STATUS (FIX ƒê√öNG LOGIC) ===== */
        .status-paid {
            background: linear-gradient(135deg, #10B981, #34D399);
            color: white;
        }
        .status-unpaid {
            background: linear-gradient(135deg, #F59E0B, #FBBF24);
            color: white;
        }
        .status-refund {
            background: linear-gradient(135deg, #EF4444, #DC2626);
            color: white;
        }

        .badge {
            padding: 0.45rem 0.9rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        </style>
    </th:block>

</head>

<body>
<section th:fragment="content">
    <div class="card">
        <div class="card-body">
            <!-- HEADER -->
            <div class="page-header">
                <h5>üí≥ Qu·∫£n l√Ω Thanh To√°n</h5>
                <div>
                    T·ªïng giao d·ªãch:
                    <strong th:text="${thanhToans != null ? thanhToans.size() : 0}">0</strong>
                    |
                    T·ªïng doanh thu:
                    <strong th:text="${#numbers.formatInteger(totalRevenue,0,'COMMA')} + ' ƒë'">0 ƒë</strong>
                </div>
            </div>

            <!-- FILTER -->
            <div class="filter-section">
                <form method="get" th:action="@{/admin/thanh-toan}" class="row g-3">

                    <!-- PH∆Ø∆†NG TH·ª®C -->
                    <div class="col-md-3">
                        <label>Ph∆∞∆°ng th·ª©c</label>
                        <select name="phuongThuc" class="form-select" onchange="this.form.submit()">
                            <option value="">T·∫•t c·∫£</option>
                            <option value="ONLINE" th:selected="${phuongThuc=='ONLINE'}">Online</option>
                            <option value="COD" th:selected="${phuongThuc=='COD'}">COD</option>
                        </select>
                    </div>

                    <!-- TR·∫†NG TH√ÅI (FIX GI√Å TR·ªä) -->
                    <div class="col-md-3">
                        <label>Tr·∫°ng th√°i</label>
                        <select name="trangThai" class="form-select" onchange="this.form.submit()">
                            <option value="">T·∫•t c·∫£</option>
                            <option value="DA_THANH_TOAN" th:selected="${trangThai=='DA_THANH_TOAN'}">
                                ƒê√£ thanh to√°n
                            </option>
                            <option value="CHUA_THANH_TOAN" th:selected="${trangThai=='CHUA_THANH_TOAN'}">
                                Ch∆∞a thanh to√°n
                            </option>
                            <option value="HOAN_TIEN" th:selected="${trangThai=='HOAN_TIEN'}">
                                Ho√†n ti·ªÅn
                            </option>
                        </select>
                    </div>

                    <!-- T·ª™ NG√ÄY -->
                    <div class="col-md-3">
                        <label>T·ª´ ng√†y</label>
                        <input type="date"
                               name="fromDate"
                               th:value="${fromDate}"
                               class="form-control"
                               onchange="this.form.submit()"/>
                    </div>

                    <!-- RESET -->
                    <div class="col-md-3 d-flex align-items-end">
                        <a href="/admin/thanh-toan" class="btn btn-secondary w-100">Reset</a>
                    </div>
                </form>
            </div>

            <!-- TABLE -->
            <table class="table table-hover">
                <thead>
                <tr>
                    <th>M√£ TT</th>
                    <th>ƒê∆°n h√†ng</th>
                    <th>S·ªë ti·ªÅn</th>
                    <th>Ph∆∞∆°ng th·ª©c</th>
                    <th>Tr·∫°ng th√°i</th>
                    <th>Ng√†y</th>
                    <th></th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="tt : ${thanhToans}">
                    <td><span class="payment-id" th:text="'#TT'+${tt.id}"></span></td>
                    <td>#ƒêH<span th:text="${tt.donHang.id}"></span></td>
                    <td th:text="${#numbers.formatInteger(tt.soTien,0,'COMMA')} + ' ƒë'"></td>

                    <td>
                    <span class="badge"
                          th:classappend="${tt.phuongThuc=='ONLINE'?'method-online':'method-cod'}"
                          th:text="${tt.phuongThuc}">
                    </span>
                    </td>

                    <td>
                    <span class="badge"
                          th:classappend="
                            ${tt.trangThai=='DA_THANH_TOAN' ? 'status-paid' :
                              (tt.trangThai=='CHUA_THANH_TOAN' ? 'status-unpaid' : 'status-refund')}"
                          th:text="
                            ${tt.trangThai=='DA_THANH_TOAN' ? 'ƒê√£ thanh to√°n' :
                              (tt.trangThai=='CHUA_THANH_TOAN' ? 'Ch∆∞a thanh to√°n' : 'Ho√†n ti·ªÅn')}">
                    </span>
                    </td>

                    <td th:text="${#temporals.format(tt.ngayThanhToan,'dd/MM/yyyy HH:mm')}"></td>
                    <td>
                        <a th:href="@{'/admin/thanh-toan/detail/'+${tt.id}}"
                           class="btn btn-sm btn-primary">Chi ti·∫øt</a>
                    </td>
                </tr>

                <tr th:if="${thanhToans == null or thanhToans.size() == 0}">
                    <td colspan="7" class="text-center text-muted">Ch∆∞a c√≥ giao d·ªãch</td>
                </tr>
                </tbody>
            </table>

        </div>
    </div>

</section>

<th:block th:fragment="scripts"> <script>console.log("Thanh to√°n list loaded");</script>
</th:block>

</body>
</html>
