<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{fragments/_LayoutAdmin :: layout(
            title='Món ăn',
            headerTitle='Quản lý Món ăn',
            content=~{::content},
            customStyles=~{::styles},
            customScripts=~{::scripts}
      )}">

<head>
    <th:block th:fragment="styles">
        <style>
            table {
                background: white;
            }
        </style>
    </th:block>
</head>

<body>

<section th:fragment="content">

    <div class="card shadow-sm">
        <div class="card-body">

            <!-- Header & button tạo mới -->
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="mb-0">Danh sách Món ăn</h5>
                <a href="/admin/mon-an/create" class="btn btn-success">
                    <i class="bi bi-plus-circle"></i> Thêm mới
                </a>
            </div>

            <!-- Hiển thị lỗi nếu có -->
            <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>

            <!-- Form tìm kiếm & lọc thể loại -->
            <form method="get" th:action="@{/admin/mon-an}" class="mb-3">
                <input type="text" name="search" th:value="${search}" placeholder="Tìm kiếm..." class="form-control mb-2"/>

                <select name="theLoaiId" class="form-select mb-2">
                    <!-- Option mặc định -->
                    <option th:value="''" th:text="'Tất cả thể loại'" th:selected="${theLoaiId == null}"></option>


                    <!-- Loop danh sách thể loại -->
                    <option th:each="theLoai : ${theLoaiList}"
                            th:value="${theLoai.id}"
                            th:text="${theLoai.tenTheLoai}"
                            th:selected="${theLoaiId != null and theLoaiId == theLoai.id}">

                    </option>
                </select>

                <button type="submit" class="btn btn-primary">Tìm kiếm</button>
            </form>

            <!-- Bảng danh sách món ăn -->
            <table class="table table-striped table-bordered">
                <thead>
                <tr>
                    <th>Tên món ăn</th>
                    <th>Thể loại</th>
                    <th>Mô tả</th>
                    <th>Giá</th>
                    <th>Hình ảnh</th>
                    <th style="width: 150px">Hành động</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="ma : ${monAnPage.content}">
                    <td th:text="${ma.ten}"></td>
                    <td th:text="${ma.theLoai != null ? ma.theLoai.tenTheLoai : 'Chưa có'}"></td>
                    <td th:text="${ma.moTa}"></td>
                    <td th:text="${ma.gia}"></td>
                    <td>
                    <span th:each="img : ${ma.hinhAnh}" class="d-block mb-1">
                        <img th:src="@{${img}}" alt="Hình món ăn" style="max-width: 100px; max-height: 80px;"/>
                    </span>
                    </td>

                    <td>
                        <a th:href="@{'/admin/mon-an/edit/' + ${ma.id}}" class="btn btn-primary btn-sm">
                            <i class="bi bi-pencil"></i>
                        </a>
                        <a th:href="@{'/admin/mon-an/delete/' + ${ma.id}}"
                           class="btn btn-danger btn-sm"
                           onclick="return confirm('Bạn có chắc muốn xóa?')">
                            <i class="bi bi-trash"></i>
                        </a>
                    </td>
                </tr>
                </tbody>
            </table>

            <!-- Phân trang -->
            <nav th:if="${monAnPage.totalPages > 1}">
                <ul class="pagination">
                    <li class="page-item" th:classappend="${monAnPage.first} ? 'disabled'">
                        <a class="page-link"
                           th:href="@{/admin/mon-an(page=${monAnPage.number - 1}, search=${search}, theLoaiId=${theLoaiId})}">
                            Trước
                        </a>
                    </li>
                    <li class="page-item disabled">
                        <span class="page-link"
                              th:text="'Trang ' + (${monAnPage.number + 1}) + ' / ' + ${monAnPage.totalPages}"></span>
                    </li>
                    <li class="page-item" th:classappend="${monAnPage.last} ? 'disabled'">
                        <a class="page-link"
                           th:href="@{/admin/mon-an(page=${monAnPage.number + 1}, search=${search}, theLoaiId=${theLoaiId})}">
                            Sau
                        </a>
                    </li>
                </ul>
            </nav>

        </div>
    </div>

</section>

<th:block th:fragment="scripts">
    <script>
        console.log("Loaded list món ăn");
    </script>
</th:block>

</body>
</html>
